# Mpush 安卓客户端3.0

这个版本只依赖FCM推送，不再在后台保留websocket连接
只推荐能够稳定连接FCM、安装了edxposed、安卓10的用户使用

## 如果安卓了xposed  
请安装这个模块[https://github.com/kooritea/fcmfix](https://github.com/kooritea/fcmfix)  
并在模块中选中com.kooritea.mpush  
这能够让fcm的送达率达到100%  

# 关于FCM

## 接收FCM推送的必要条件

- 众所周知的原因
- 应用在后台存活

### 如何判断自己是否连接了FCM服务器

在拨号界面输入 `*#*#426*#*#`  
如果HOST有显示出mtalk.google.com/94.233.189.188这样`域名/ip`地址的字样，`Time connected：时间` 这样的字样，基本上就没有问题

### 判断mpush客户端已在后台待机

在设置-> 应用里面查看mpush客户端的详细信息，如果下面的`结束运行`的按钮是亮着的，证明mpush客户端已经在后台待机


### 如何保持FCM连接  
1、首先需要有稳定的网络环境  
2、其次，尽量使用类原生等未阉割gms服务的ROM，推荐xiaomi.eu(关于eu版如何本地化可以看我另外一个仓库)  
使用国内ROM可能出现的问题  
- fcm异常断开后不会重连(如国内版miui)，只能通过切换网络环境强制重连
- 等等

### 应用在后台存活  
不要在任务管理器划掉就好了  
但是实际上只要内存紧张的时候还是会被杀掉，所以想要稳定的推送单靠不划掉任务还远远不够，还要做各种各样的耗电保活    
因为这个原因所以必须要在通知到达率和耗电上做取舍，这次3.0使用fcm就是要降低耗电，所以不再做2.0那样暴力保活

之所以推荐使用fcmfix+edxposed的组合，是因为这样可以让被完全杀掉的应用也能够响应fcm发出通知，安装fcmfix并选中mpush客户端即可

这样即使是应用被完全杀掉，内存紧张，当有通知时也会拉起应用发送通知，送达率几乎可以达到100%(除非一直连不上fcm)

